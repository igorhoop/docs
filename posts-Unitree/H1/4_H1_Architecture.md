# Обзор SDK H1

## H1

Робот H1 в качестве промежуточного межпрограммного сообщения и основного взаимодействия данных использует два мода: **subscpition/publish** и **request/response**.
<p>**subscpition/publish:** получатель подписывается на сообщение, которое отправитель рассылает получателям в соответствии с подписочным списком. Такой метод в основном используется для средне и высокочастотного и продолжительного взаимодействия с данными.</p>
<p>**request/response**: вопросно-ответная форма сообщения, при которой сбор и взаимодействие с данными осуществляется посредством запросов. Этот метод используется для переключения функций или при низкой частоте необходимости взаимодействия с данными.
Вызов метода осуществляется по средством запросов API и вызовов функций.</p>
 
![api](/assets/images/sdk1.png){: width="600px" style="display: block; margin: 0 auto"}

## Архитектура
 
В своей структуре робот использует облачные службы и сервера.

1.	Осуществляет сбор данных об эксплуатации, ошибочном поведении и статистике.
2.	Помогает пользователям достигать функций удаленного управления через шлюз WebRTC. Отображая и контролируя трафик, которой можно прокинуть без обработки и анализа сервером.
3.	Выполняет обновления программного обеспечения.
Коммуникация со службами достигается за счет **MQTT** брокера, который используется для глубокого взаимодействия со всеми участниками сети и выполняет мониторинг ошибок, системные обновления и передачу ==**WebRTC**== сигналов.
---
1.	Модуль коммуникаций OTA взаимодействует с облачной службой через MQTT и отвечает за принятие системных обновлений, выгрузку логов ошибок и проброс WebRTC сигналов.
2.	Модуль WebRTC исполняет роль основного канала данных с мобильным приложением включая аудио и видео потоки, облако точек вместе с матрицами преобразования, инструкции управления и движения вместе с текущими показателями.
3.	Протокол Bluetooth Low Energy (BLE) устанавливает контакт с приложением и служит для безопасной настройки основной сети и верификации.
4.	Коммуникация между каждым описанным модулем в основном исполняется на DDS сервере, который в свою очередь по средству DDS IDL обеспечивает “мост” с ROS2 только с локальной машины. В образовательной версии EDU можно вызывать интерфейсы отдельно, как через DDS, так и ROS2.
5.	Данные с датчиков такие как данные моторов и радаров собираются через последовательный порт и затем пересылаются на средний слой DDS.
6.	H1 включает в себя 3 отдельных компьютера. ПК1 выделен под программу движения Unitree и не может быть открыт публично. ПК2/ПК3 открыты для разработчиков и имеют следующие адреса **192.168.123.162 \ 192.168.123.163** соответственно.
\
![Harchitecture](/assets/images/sdk2.png){: width="600px" style="display: block; margin: 0 auto"}

## Внешние интерфейсы разработчика

Поддерживаются следующие интерфейсы и их соответствующие средства для разработки:\
1.	DDS;
2.	ROS2;
3.	GST, только для стриминга изображение и видео.

## Структура DDS

![Структура DDS H1](/assets/images/sdk3.png){: width="400px" style="display: block; margin: 0 auto"}

  **DDS**(Служба распространения данных) это межпрограммный слой, является спецификацией распределенной связи. Служба принимает модель вещателя/подписчика и вызывает различные **QoS** службы политики качества для гарантии работы в режиме реального времени, эффективности и гибкости распространения данных.\
  Используется так же для взаимодействия службами запущенными на разный компьютерах.
  
![dds](/assets/images/sdk4.png){: width="600px" style="display: block; margin: 0 auto"}


## Программная архитектура робота

На основном компьютере **ПК1** у робота запущенны сервисы, общающиеся через слой DDS.\

 ![H1services](/assets/images/h1services.png){: width="600px" style="display: block; margin: 0 auto"}

1. Basic service(базовая служба) в реальном времени получает данные о работе аккумулятора, приводов и IMU. Именно базовый интерфейс обладает доступом к интерфейсу команд низкого уровня для управления непосредсвенно приводами. С базовым сервисом можно взаимодействовать через DDS и упралвять приводами.\

![H1basicservice](/assets/images/h1basicservice.png){: width="600px" style="display: block; margin: 0 auto"}

2. High-level motion service(Высокоуровневая служба движения) отвечает за высокоуровневое движение, содержит в себе комманды переключения походки робота, управления позой и скоростями подъема ног и рук. Взаимодействие с данным сервисом возможно через RPC или DDS.\

![H1hlmotionservice](/assets/images/h1hlmotionservice.png){: width="600px" style="display: block; margin: 0 auto"}

3. RobotStateClient(Служба состояния) используется для взаимодействия с другими службами в H1, а так же отвечает за состояние контроллера ходьбы. Использует только RPC для взаимодействия.\
4. Internet service содержит настройки беспроводной сети, а также ноды для связи с мобильным приложением по средству **STA**(режим станции) и **AP**(режим активной точки доступа).\
5. Image service отвечает за стримминг изображений и видео, однако на данный момент не используется.
6. Lidar service(лидарная служба) содержит облако точек и трансформы для них, а также данные с IMU датчика. Строит 3D воксельные карты. Взаимодействие с данной службой доступно через DDS.\
 

### Установка SDK
  
**unitree_sdk2** – пакет средств разработки созданный **Unitree Technology**. Представляет экранированные интерфейсы для базового управления приводами и высокоуровневого управления движениями, и обеспечивает соответствующие функции внешним интерфейсам роботов.

---

[Ссылка на СДК](https://github.com/unitreerobotics/unitree_sdk2)\
\
[Ссылка на модель URDF](https://unitree-firmware.oss-cn-hangzhou.aliyuncs.com/tool/h1_description_0412.zip)

---
